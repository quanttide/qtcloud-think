# Meta 模块设计 (v0.0.2)

## 功能定义

Meta 模块的核心能力：**观察思考云自身，提出对系统的改进建议**

这意味着：
- 对系统的运行效果进行分析
- 识别系统问题、改进空间、用户体验痛点
- 为开发者提供建设性的优化建议

---

## 核心流程

```
用户输入 → 澄清处理 → 存储 → Meta 自省 → 输出系统改进建议
```

---

## 设计要点

| 需求项 | 决策 |
|--------|------|
| 触发方式 | 手动触发（meta 命令） |
| 分析维度 | 统计指标 + 语义分析 |
| 输出格式 | 结构化建议，输出到 Markdown |
| 存储路径 | `data/meta/{date}.md` |

---

## 需要收集的数据维度

| 数据维度 | 具体指标 | 异常信号 |
|---------|---------|---------|
| 对话效率 | 轮次、耗时 | 轮次 > 5 或耗时过长 |
| 意图理解 | 首轮是否抓住核心 | 多轮后意图仍偏移 |
| 澄清结果 | 是否成功存储 | 多次失败 |
| 用户反馈 | 满意度/放弃 | 用户中断 |
| 成本 | API 调用次数 | 单次成本过高 |
| 错误 | 异常类型/频率 | 错误率上升 |

---

## 系统提示词设计

AI 需要知道自己的身份和能力：

```python
SYSTEM_PROMPT = """你是"思维外脑"——一个思维收集与澄清助手。

## 你的身份
- 你是一个 AI 助手，帮助用户理清思路、沉淀思考
- 你的目标是帮助用户把碎片化的想法转化为结构化的知识

## 你的能力
- 判断用户输入是否清晰完整
- 通过对话引导用户补充关键信息
- 将澄清后的想法总结成结构化内容

## 你的原则
- 保持友好，自然的对话风格
- 不给用户压力，像朋友聊天一样帮助他们
- 每次只问 1-2 个关键问题
- 用户不想说时不要追问"""
```

---

## 实际运行中发现的问题

### 问题 1：存储失败

- **现象**：存储失败次数 3/3
- **原因**：session_record 传递或保存逻辑问题
- **状态**：待修复

### 问题 2：耗时过长

- **现象**：平均耗时 196s
- **原因**：LLM 响应慢或网络问题
- **状态**：观察中

### 问题 3：用户中断

- **现象**：用户中断 1/3
- **原因**：用户输入"完成"时没有友好结束语

---

## 改进建议（来自 Meta 语义分析）

1. 增强对话状态机机制，当检测到用户输入"完成"、"结束"等终止信号时，自动触发总结确认或礼貌结束语

2. 优化对短文本和抽象问题的处理逻辑：
   - 针对"二选一"的纠结提供对比分析
   - 针对身份问题提供标准化的自我描述

3. 引入意图识别模块，在用户话题发生剧烈跳跃时，主动询问是否需要切换上下文或澄清当前目标

---

## 输出示例

```markdown
---
date: 2026-02-18
session_count: 3
avg_rounds: 1.0
avg_api_calls: 2.3
avg_duration: 196.0s
---

# Meta 自省报告

## 汇总统计
- 会话总数: 3
- 平均澄清轮次: 1.0
- 平均 API 调用: 2.3
- 平均耗时: 196.0s

## 发现问题
- 平均耗时过长: 196.0s
- 用户中断次数: 1/3
- 存储失败次数: 3/3

## 改进建议
1. 建议检查 LLM 响应速度
2. 追问方式可能不够友好，需要优化
3. 增强对话状态机机制...
```
